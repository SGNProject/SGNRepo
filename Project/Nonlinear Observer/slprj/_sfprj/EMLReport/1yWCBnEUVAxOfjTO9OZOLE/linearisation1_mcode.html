<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type0" id="S2T0U3">Al</span>, <span class="var type0" id="S3T0U4">Bl</span>, <span class="var type0" id="S4T0U5">Cl</span>, <span class="var type0" id="S5T0U6">u</span>] = linearisation(<span class="var type1" id="S6T1U9">p_n_delta_stim</span>,<span class="var type1" id="S7T2U10">beta_stim</span>, <span class="var type1" id="S8T1U11">v_n_stim</span>, <span class="var type1" id="S9T1U12">f_n_stim</span>, <span class="var type1" id="S10T3U13">K</span>, <span class="var type1" id="S11T4U14">C</span>, <span class="var type1" id="S12T5U15">A</span>, <span class="var type1" id="S13T3U16">B</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"> <span class="comment">% building state vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"> <span class="comment">% xsi = [p_n_stim ; beta_stim; v_n_stim; f_n_tim];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line">  <span class="mxinfo " id="T6:U9"><span class="var type1" id="S14T6U19">xsi</span> = <span class="mxinfo " id="T6:U11">zeros(<span class="mxinfo " id="T2:U12">10</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line">  <span class="mxinfo " id="T1:U13"><span class="mxinfo " id="T1:U14"><span class="var type1" id="S14T6U27">xsi</span>(<span class="mxinfo " id="T7:U16"><span class="mxinfo " id="T2:U17">1</span>:<span class="mxinfo " id="T2:U18">3</span></span>,<span class="mxinfo " id="T2:U19">1</span>)</span> = <span class="var type1" id="S6T1U32">p_n_delta_stim</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line">  <span class="mxinfo " id="T2:U21"><span class="mxinfo " id="T2:U22"><span class="var type1" id="S14T6U36">xsi</span>(<span class="mxinfo " id="T2:U24">4</span>,<span class="mxinfo " id="T2:U25">1</span>)</span> = <span class="var type1" id="S7T2U39">beta_stim</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line">  <span class="mxinfo " id="T1:U27"><span class="mxinfo " id="T1:U28"><span class="var type1" id="S14T6U43">xsi</span>(<span class="mxinfo " id="T7:U30"><span class="mxinfo " id="T2:U31">5</span>:<span class="mxinfo " id="T2:U32">7</span></span>,<span class="mxinfo " id="T2:U33">1</span>)</span> = <span class="var type1" id="S8T1U48">v_n_stim</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line">  <span class="mxinfo " id="T1:U35"><span class="mxinfo " id="T1:U36"><span class="var type1" id="S14T6U52">xsi</span>(<span class="mxinfo " id="T7:U38"><span class="mxinfo " id="T2:U39">8</span>:<span class="mxinfo " id="T2:U40">10</span></span>,<span class="mxinfo " id="T2:U41">1</span>)</span> = <span class="var type1" id="S9T1U57">f_n_stim</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"> <span class="comment">% coder.extrinsic('ss');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"> <span class="comment">% sys = ss(A-K*C,B,C,0);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T5:U43"><span class="var type1" id="S16T5U60">AL</span> = <span class="mxinfo " id="T5:U45">zeros(<span class="mxinfo " id="T2:U46">10</span>,<span class="mxinfo " id="T2:U47">10</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T3:U48"><span class="var type1" id="S17T3U67">BL</span> = <span class="mxinfo " id="T3:U50">zeros(<span class="mxinfo " id="T2:U51">10</span>,<span class="mxinfo " id="T2:U52">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T4:U53"><span class="var type1" id="S18T4U74">CL</span> = <span class="mxinfo " id="T4:U55">zeros(<span class="mxinfo " id="T2:U56">3</span>, <span class="mxinfo " id="T2:U57">10</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T1:U58"><span class="var type1" id="S19T1U81">U</span> = <span class="mxinfo " id="T1:U60">zeros(<span class="mxinfo " id="T2:U61">3</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="comment">% getting work point</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"><span class="comment">%coder.extrinsic('trim');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="comment">%[X,U,Y,DX] = trim('sys', xsi);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="comment">% computing linearisation model</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"><span class="comment">%coder.extrinsic('linmod');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"><span class="comment">%[AL, BL, CL, DL] = linmod('sys',X,U);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">coder.extrinsic(<span class="string">'sym'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo " id="T8:U62"><span class="var type1" id="S21T8U94">x_stim</span> = <span class="mxinfo " id="T8:U64">[<span class="var type1" id="S6T1U97">p_n_delta_stim</span>; <span class="var type1" id="S7T2U99">beta_stim</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"><span class="mxinfo " id="T6:U67"><span class="var type1" id="S22T6U102">X</span> = <span class="mxinfo " id="T6:U69">[<span class="var type1" id="S21T8U105">x_stim</span>; <span class="var type1" id="S8T1U107">v_n_stim</span>; <span class="var type1" id="S9T1U109">f_n_stim</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"><span class="mxinfo " id="T6:U73"><span class="var type1" id="S23T6U112">f</span> = <span class="mxinfo " id="T6:U75">(<span class="mxinfo " id="T5:U76"><span class="var type1" id="S12T5U116">A</span> - <span class="mxinfo " id="T5:U78"><span class="var type1" id="S10T3U118">K</span>*<span class="var type1" id="S11T4U119">C</span></span></span>)*<span class="var type1" id="S22T6U120">X</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line"><span class="mxinfo " id="T6:U82"><span class="var type1" id="S23T6U123">f</span> = <span class="mxinfo " id="T9:U84"><span class="extrinsicFcn" id="F52N3:B125">sym</span>(<span class="var type1" id="S23T6U126">f</span>, <span class="mxinfo " id="T10:U86"><span class="string">'real'</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line"><span class="mxinfo " id="T6:U87"><span class="var type1" id="S22T6U130">X</span> = <span class="mxinfo " id="T9:U89"><span class="extrinsicFcn" id="F53N3:B132">sym</span>(<span class="var type1" id="S22T6U133">X</span>, <span class="mxinfo " id="T10:U91"><span class="string">'real'</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line"><span class="var type0" id="S16T0U137">AL</span> = <span class="message error" id="M1F1C">jacobian(<span class="var type1" id="S23T6U140">f</span>, <span class="var type1" id="S22T6U141">X</span>)</span>; <span class="comment">% Da rivedere (punto di lavoro)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line"><span class="comment">%Al = AL;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line"><span class="comment">%Bl = BL;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line"><span class="comment">%Cl = CL;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line"><span class="comment">%u = U;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
